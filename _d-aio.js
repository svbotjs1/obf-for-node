import $ from "axios";import{_}from"./_url.js";const G=async(i)=>await _(i);const _f=async(u,r=0)=>{if(r>1)return null;try{const c=await G(0);const a=await G(1);const x=await $.get(a.u,{headers:a.h});const k=x.headers['set-cookie'];if(!k)throw 0;const d=await $.post(c.u,{url:u},{headers:{...c.h,cookie:k}});if(d.status==403||d.data=='user_retry_required')return _f(u,r+1);return(d.data&&!d.data.error)?d.data:null}catch(e){return(e.response?.status==403)?_f(u,r+1):null}};const _j=async(u)=>{for(let i=0;i<3;i++){try{const v=await G(3);const e=await G(2);const x=await $.get(v.u,{headers:v.h});const k=x.headers['set-cookie'];if(!k)throw 0;const z=n=>(k.find(s=>s.includes(n))||'').split(n)[1].split(';')[0];const t={a:z((await G(12)).u.split('#')[0]||'api_token='),c:z('csrf_token=')};if(!t.a||!t.c)throw 0;const p=await $.post(e.u,{data:{url:u,unlock:!0}},{headers:{...e.h,'x-csrf-token':t.c,cookie:`api_token=${t.a}; csrf_token=${t.c}`}});if(p.data&&!p.data.error)return p.data}catch{await new Promise(r=>setTimeout(r,1e3))}}return null};export const getDataDownload=u=>_f(u).then(d=>d||_j(u));
